parameters: 
  - name: ServiceConnectionName
    type: string
  - name: ImageId
    type: string
steps:
- ${{ if ne(parameters.ServiceConnectionName, '' ) }}:
  - task: AzureCLI@2
    displayName: Authenticate to Container Registry
    inputs:
      azureSubscription: ${{ parameters.ServiceConnectionName }}
      scriptType: pscore
      scriptLocation: inlineScript
      inlineScript: |
        # azuresdkimages.azurecr.io/pyrefautocr:latest -> azuresdkimages
        $containerRegistryName = ("${{parameters.ImageId}}" -split "\/")[0].Replace("azurecr.io", "")

        az acr login --name $containerRegistryName

- pwsh: |
    docker pull '${{ parameters.ImageId}}'
  displayName: Pull docker image ${{ parameters.ImageId }}
