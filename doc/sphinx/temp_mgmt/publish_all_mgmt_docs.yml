 parameters:
  - name: MgmtPackages
    type: object
    default:
      azure-mgmt-advisor:
        ServiceDirectory: advisor
        Version: '10.0.0b1'

 steps:
  - task: UsePythonVersion@0
    displayName: 'Use Python 3.11'
    inputs:
      versionSpec: '3.11'
  
  - task: PythonScript@0
    displayName: 'checkout eng/tools/doc/scripts from main'
    inputs:
      scriptPath: 'checkout_eng.py'

  - script: |
      python -m pip install setuptools==58.3.0
      python -m pip install -r eng/ci_tools.txt
    displayName: 'Prep Environment'

  - ${{ each pkg in parameters.MgmtPackages }}:
    - task: PythonScript@0
      displayName: 'checkout library tag'
      inputs:
        scriptPath: 'checkout_tag.py'
        arguments: >-
          --package=${{ pkg.key }}
          --service=${{ pkg.value.ServiceDirectory }}
          --version=${{ pkg.value.Version }}

    - task: PythonScript@0
      displayName: 'Generate Docs'
      inputs:
        scriptPath: 'scripts/devops_tasks/dispatch_tox.py'
        arguments: >-
          ${{ pkg.key }}
          --service=${{ pkg.value.ServiceDirectory }}
          --dest-dir="$(Build.ArtifactStagingDirectory)"
          --toxenv=sphinx
    